<!DOCTYPE html>
<html>
<head>
    <title>Admin – Verified Students</title>

    <style>
        body { font-family: Arial; background:#f5f5f5; margin:0; }
        header {
            background:white; padding:15px 20px; border-bottom:1px solid #ccc;
            display:flex; justify-content:space-between; align-items:center;
        }
        .container {
            max-width:1000px; margin:30px auto; background:white;
            padding:20px; border-radius:10px;
            box-shadow:0 3px 12px rgba(0,0,0,0.08);
        }
        table { width:100%; border-collapse:collapse; margin-top:20px; }
        th, td { padding:12px; border-bottom:1px solid #eee; }
        th { background:#fafafa; }

        /* Accordion */
        .panel {
            display:none; padding:12px; border:1px solid #ddd;
            border-radius:6px; background:white; margin-bottom:15px;
        }

        .label { font-weight:bold; margin-top:10px; display:block; }
        .value { margin-bottom:10px; color:#333; }

        .status-box {
            padding:6px 10px; border-radius:6px; color:white;
            font-weight:bold; width:120px; text-align:center;
        }
        .select { background:green; }
        .reject { background:red; }
        .hold { background:#c97f00; }
        
        .clickable-id {
            color:#0066cc;
            cursor:pointer;
            text-decoration:underline;
        }
    </style>
</head>

<body>

<header>
    <img src="{{ url_for('static', filename='logo_icon.jpg') }}" height="45">
    <h2>Admin Panel – Verified Students</h2>
    <a href="/logout">Logout</a>
</header>

<div class="container">

    <h3>Students Who Completed PV</h3>

    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>Student ID</th>
                <th>Name</th>
                <th>District</th>
                <th>Status</th>
            </tr>
        </thead>

        <tbody>
            {% for s in students %}
           <tr>
    <td>{{ loop.index }}</td>

    <!-- STUDENT ID NOW OPENS admin_view.html -->
    <td>
        <a href="{{ url_for('admin_decision', student_id=s.studentId) }}"
           style="color:#0066cc; text-decoration:underline; cursor:pointer;">
           {{ s.studentId }}
        </a>
    </td>

    <td>{{ s.name }}</td>
    <td>{{ s.district }}</td>

    <td>
        <span class="status-box 
            {% if s.status == 'SELECT' %}select{% endif %}
            {% if s.status == 'REJECT' %}reject{% endif %}
            {% if s.status == 'ON HOLD' %}hold{% endif %}
        ">
            {{ s.status }}
        </span>
    </td>
</tr>
            <!-- ACCORDION PANEL FOR DETAILS -->
            <tr>
                <td colspan="5">
                    <div id="panel{{ loop.index }}" class="panel">

                        <span class="label">Elements Observed:</span>
                        <div class="value">{{ s.whatYouSaw }}</div>

                        <span class="label">Volunteer Comment:</span>
                        <div class="value">{{ s.comment }}</div>

                        <span class="label">Property Type:</span>
                        <div class="value">{{ s.propertyType }}</div>

                        <span class="label">Sentiment Score (Text):</span>
                        <div class="value">{{ s.sentiment_text }}</div>

                        <span class="label">AI Summary:</span>
                        <div class="value">{{ s.elementsSummary }}</div>

                        <span class="label">Voice Comments (Transcript):</span>
                        <div class="value">{{ s.voice_comments }}</div>

                        <span class="label">Final Status:</span>
                        <div class="value">{{ s.status }}</div>

                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>

    </table>

</div>

<script>
    async function loadPendingStudentsAdmin() {
  try {
    const res = await fetch('/api/admin/pending-students');
    const data = await res.json();
    if (data.error) {
      console.error(data.error);
      return;
    }
    // Example: assume <div id="admin-pending-list"></div> exists
    const container = document.getElementById('admin-pending-list');
    if (!container) return;
    container.innerHTML = '';
    data.students.forEach(s => {
      const row = document.createElement('div');
      row.className = 'admin-row';
      row.innerHTML = `
        <a href="/admin/decision/${s.studentId}">${s.studentId} - ${s.name}</a>
        <span>${s.district}</span>
        <span style="margin-left:10px">${s.pv_status || ''}</span>
      `;
      container.appendChild(row);
    });
  } catch (err) {
    console.error('Failed to load admin pending students', err);
  }
}

loadPendingStudentsAdmin();
setInterval(loadPendingStudentsAdmin, 6000); // every 6s
function togglePanel(id) {
    var p = document.getElementById(id);
    p.style.display = (p.style.display === "block") ? "none" : "block";
}
</script>

</body>
</html>
